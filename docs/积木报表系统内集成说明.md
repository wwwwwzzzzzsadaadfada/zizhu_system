# 积木报表系统内集成说明

## 一、当前实现

已实现将积木报表集成到系统菜单中，并添加了以下功能：

### 1. 工具栏功能
- **报表列表**：快速跳转到报表列表页面
- **新建报表**：快速跳转到报表设计器
- **刷新**：刷新当前 iframe 页面

### 2. 导航拦截
- 尝试拦截 iframe 内的链接点击，确保在 iframe 内打开
- 尝试拦截 `window.open`，改为在 iframe 内打开

## 二、跨域限制说明

由于浏览器安全策略，如果积木报表页面和系统页面不在同一个域下，可能会出现跨域限制：
- 无法直接访问 iframe 内的 DOM
- 无法拦截 iframe 内的链接点击
- 无法拦截 iframe 内的 `window.open`

## 三、解决方案

### 方案1：使用工具栏导航（推荐）

使用页面顶部的工具栏按钮来导航：
- 点击"报表列表"查看所有报表
- 点击"新建报表"打开设计器
- 点击"刷新"刷新当前页面

### 方案2：配置积木报表（如果支持）

如果积木报表支持配置，可以：
1. 修改积木报表的配置，让所有链接默认在 iframe 内打开
2. 禁用 `target="_blank"` 属性
3. 使用相对路径而不是绝对路径

### 方案3：使用 postMessage 通信（高级）

如果积木报表支持 postMessage 通信，可以实现：
1. 积木报表页面通过 `postMessage` 发送导航消息
2. 系统页面监听消息并更新 iframe URL

## 四、使用建议

1. **优先使用工具栏**：使用页面顶部的工具栏按钮进行导航
2. **如果链接在新窗口打开**：
   - 复制新窗口的 URL
   - 在工具栏中手动输入 URL 或使用浏览器的地址栏
3. **刷新页面**：如果页面显示异常，点击"刷新"按钮

## 五、技术说明

### 当前实现的技术细节

1. **动态 URL 更新**：iframe 支持动态更新 `src` 属性
2. **导航拦截**：尝试拦截 iframe 内的链接和 `window.open`
3. **跨域处理**：如果遇到跨域限制，会静默失败，不影响正常使用

### 代码位置

- 前端组件：`ruoyi-ui/src/views/system/report/jimuReport.vue`
- iframe 组件：`ruoyi-ui/src/components/iFrame/index.vue`
- 后端 Filter：`ruoyi-framework/src/main/java/com/ruoyi/framework/filter/JimuReportFrameOptionsFilter.java`

## 六、后续优化建议

1. **添加更多工具栏按钮**：根据积木报表的常用功能添加更多快捷按钮
2. **添加 URL 输入框**：允许用户直接输入 URL 跳转
3. **添加历史记录**：记录访问历史，支持前进/后退
4. **优化加载状态**：改进加载提示和错误处理

