# 报表预览页面后端接口说明

## 一、报表列表接口

### 1.1 接口说明

获取系统中所有的报表列表，用于报表预览页面的下拉选择框。

### 1.2 接口定义

**请求地址**: `/system/report/list`

**请求方式**: `GET`

**请求参数**: 无

**响应格式**:
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": [
    {
      "id": "1159821341794144256",
      "name": "普通高中国家助学金申请表",
      "code": "student_aid_application",
      "createTime": "2024-12-14 10:00:00"
    }
  ]
}
```

### 1.3 SQL查询语句

如果后端接口不存在，可以使用以下SQL从积木报表表中查询：

```sql
SELECT 
    id,
    name,
    code,
    create_time AS createTime
FROM jimu_report
WHERE status = '1'  -- 1=启用，0=禁用
ORDER BY create_time DESC
```

### 1.4 Java Controller 实现（可选）

如果后端没有这个接口，可以创建以下Controller：

```java
@RestController
@RequestMapping("/system/report")
public class ReportController {
    
    @Autowired
    private JdbcTemplate jdbcTemplate;
    
    /**
     * 查询报表列表
     */
    @GetMapping("/list")
    public AjaxResult list() {
        String sql = "SELECT id, name, code, create_time AS createTime " +
                     "FROM jimu_report " +
                     "WHERE status = '1' " +
                     "ORDER BY create_time DESC";
        
        List<Map<String, Object>> reports = jdbcTemplate.queryForList(sql);
        return AjaxResult.success(reports);
    }
}
```

## 二、学生查询接口

学生查询接口已存在：`/system/studentsBase/list`

### 2.1 接口说明

根据学生姓名查询学生列表，用于报表预览页面的学生搜索。

### 2.2 接口参数

```javascript
{
  name: "学生姓名",  // 姓名模糊查询
  pageNum: 1,
  pageSize: 50
}
```

### 2.3 响应格式

前端期望的响应格式应包含以下字段：

```json
{
  "code": 200,
  "rows": [
    {
      "id": 1,
      "name": "张三",
      "studentNo": "G452630199805052568",
      "gradeName": "高一",
      "className": "1班"
    }
  ]
}
```

**注意**: 如果后端返回的数据中没有 `gradeName` 和 `className` 字段，需要：
1. 修改后端接口，在查询时关联 `st_grades` 和 `st_class_info` 表
2. 或者修改前端代码，不显示这些信息

### 2.4 SQL查询语句（建议）

```sql
SELECT 
    s.id,
    s.name,
    s.student_no AS studentNo,
    g.name AS gradeName,
    c.class_name AS className
FROM st_students_base s
LEFT JOIN st_grades g ON s.grade_id = g.id
LEFT JOIN st_class_info c ON s.class_id = c.class_id
WHERE s.name LIKE CONCAT('%', #{name}, '%')
ORDER BY s.id
LIMIT #{pageSize} OFFSET #{offset}
```

## 三、报表预览接口

报表预览功能直接使用积木报表的预览接口：

**URL格式**: `/jmreport/view/{reportId}?studentId={studentId}`

**示例**: `/jmreport/view/1159821341794144256?studentId=1`

此接口由积木报表系统提供，无需额外开发。

## 四、快速配置步骤

### 步骤1：创建后端接口（如果需要）

如果后端没有报表列表接口，按照"1.4 Java Controller 实现"创建接口。

### 步骤2：验证接口

1. 访问 `/system/report/list`，确认返回报表列表
2. 访问 `/system/studentsBase/list?name=测试`，确认返回学生列表

### 步骤3：配置前端

前端代码已经配置好，如果后端接口路径不同，修改 `ruoyi-ui/src/api/system/report.js` 中的接口地址。

### 步骤4：测试功能

1. 打开报表预览页面
2. 输入学生姓名搜索
3. 选择报表
4. 点击预览

## 五、注意事项

1. **报表ID**: 确保报表ID正确，可以从 `jimu_report` 表中查询
2. **学生ID**: 确保学生ID存在且有效
3. **权限控制**: 根据实际需求添加权限控制
4. **性能优化**: 如果报表数量很多，考虑添加分页或搜索功能
5. **错误处理**: 前端已包含错误处理，如果接口不存在会使用默认报表列表

## 六、默认报表列表

如果后端接口不存在，前端会使用默认报表列表：

```javascript
[
  {
    id: '1159821341794144256',
    name: '普通高中国家助学金申请表',
    code: 'student_aid_application'
  }
]
```

可以根据实际情况修改 `loadDefaultReportList()` 方法中的默认报表列表。


