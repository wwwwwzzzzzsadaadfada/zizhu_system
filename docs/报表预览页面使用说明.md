# 报表预览页面使用说明

## 一、功能概述

报表预览页面提供了便捷的报表查看功能，支持：
- 根据学生姓名快速搜索学生
- 选择报表进行预览
- 在新窗口中打开报表
- 打印和导出PDF功能

## 二、已完成的文件

### 1. 前端文件

#### 1.1 报表预览页面组件
- **文件路径**: `ruoyi-ui/src/views/system/report/reportPreview.vue`
- **功能**: 
  - 学生姓名搜索（自动完成）
  - 报表下拉选择
  - 报表预览显示
  - 工具栏功能（新窗口、打印、导出）

#### 1.2 报表API文件
- **文件路径**: `ruoyi-ui/src/api/system/report.js`
- **功能**: 提供报表列表查询接口

### 2. 后端文件

#### 2.1 报表Controller
- **文件路径**: `ruoyi-system/src/main/java/com/ruoyi/system/controller/ReportController.java`
- **功能**: 提供报表列表查询接口 `/system/report/list`
- **权限**: `system:report:list`

### 3. SQL脚本

#### 3.1 菜单添加脚本
- **文件路径**: `docs/sql/add_report_preview_menu.sql`
- **功能**: 添加"报表预览"菜单项到系统菜单

## 三、部署步骤

### 步骤1：执行SQL脚本添加菜单

在数据库中执行以下SQL脚本：

```bash
# 执行菜单添加脚本
mysql -u用户名 -p数据库名 < docs/sql/add_report_preview_menu.sql
```

或者在数据库管理工具中直接执行 `docs/sql/add_report_preview_menu.sql` 文件中的SQL语句。

**验证菜单是否添加成功**：
```sql
SELECT menu_id, menu_name, parent_id, path, component 
FROM sys_menu 
WHERE menu_name IN ('报表管理', '报表预览', '报表设计')
ORDER BY parent_id, order_num;
```

### 步骤2：重启后端服务

由于新增了Controller，需要重启后端服务：

```bash
# 如果使用IDE，直接重启应用
# 如果使用命令行，停止并重新启动
```

### 步骤3：验证后端接口

启动后端服务后，访问以下接口验证是否正常：

```bash
# 测试报表列表接口
curl -X GET "http://localhost:8080/system/report/list" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

**预期响应**：
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": [
    {
      "id": "1159821341794144256",
      "name": "普通高中国家助学金申请表",
      "code": "student_aid_application",
      "createTime": "2024-12-14 10:00:00"
    }
  ]
}
```

### 步骤4：验证前端页面

1. 登录系统
2. 在菜单中找到"报表管理" -> "报表预览"
3. 点击进入报表预览页面
4. 测试功能：
   - 输入学生姓名搜索
   - 选择报表
   - 点击预览按钮
   - 测试工具栏功能

## 四、功能使用

### 4.1 搜索学生

1. 在"学生姓名"输入框中输入学生姓名（支持模糊搜索）
2. 系统会自动显示匹配的学生列表
3. 点击选择学生

**显示信息**：
- 学生姓名
- 学籍号
- 年级/班级

### 4.2 选择报表

1. 在"报表"下拉框中选择要预览的报表
2. 系统会自动加载报表列表（从积木报表表获取）

### 4.3 预览报表

1. 选择学生和报表后，点击"预览"按钮
2. 报表会在下方iframe中显示
3. 如果报表加载较慢，请耐心等待

### 4.4 工具栏功能

- **新窗口打开**: 在新浏览器窗口中打开报表，方便查看和操作
- **打印**: 打开打印对话框，可以打印报表
- **导出PDF**: 导出报表为PDF文件（需要积木报表支持）

## 五、权限配置

### 5.1 菜单权限

执行SQL脚本后，会自动创建以下权限：
- `system:report:list` - 报表查询权限
- `system:report:preview` - 报表预览权限

### 5.2 角色权限分配

需要在系统管理 -> 角色管理中，为相应角色分配以下权限：
- 报表管理 -> 报表预览 -> 报表查询
- 报表管理 -> 报表预览 -> 报表预览

## 六、常见问题

### 6.1 报表列表为空

**原因**: 
- 积木报表表中没有数据
- 报表状态不是启用状态（status != '1'）

**解决方法**:
1. 检查 `jimu_report` 表中是否有数据
2. 检查报表的 `status` 字段是否为 '1'
3. 如果没有报表，需要先在"报表设计"中创建报表

### 6.2 学生搜索无结果

**原因**:
- 学生姓名输入错误
- 学生数据不存在

**解决方法**:
1. 检查学生姓名是否正确
2. 检查 `st_students_base` 表中是否有该学生
3. 尝试输入部分姓名进行模糊搜索

### 6.3 报表预览失败

**原因**:
- 报表ID不存在
- 学生ID不存在
- 报表参数配置错误

**解决方法**:
1. 检查报表ID是否正确
2. 检查学生ID是否存在
3. 检查报表的数据集参数配置是否正确
4. 查看浏览器控制台的错误信息

### 6.4 后端接口404

**原因**:
- Controller未正确扫描
- 接口路径错误

**解决方法**:
1. 检查 `ReportController` 是否在正确的包路径下
2. 检查Spring Boot的包扫描配置
3. 检查接口路径是否正确：`/system/report/list`

## 七、技术说明

### 7.1 前端技术栈
- Vue.js 2.x
- Element UI
- Axios

### 7.2 后端技术栈
- Spring Boot
- Spring Security
- JdbcTemplate

### 7.3 数据库
- MySQL
- 积木报表表：`jimu_report`
- 学生基础信息表：`st_students_base`

## 八、后续优化建议

1. **报表缓存**: 可以添加报表列表的缓存，减少数据库查询
2. **搜索优化**: 可以添加更多搜索条件（如学籍号、年级等）
3. **批量预览**: 可以添加批量预览功能
4. **报表收藏**: 可以添加常用报表收藏功能
5. **历史记录**: 可以记录预览历史，方便快速访问

## 九、联系支持

如果遇到问题，请：
1. 查看浏览器控制台的错误信息
2. 查看后端日志
3. 检查数据库数据
4. 参考本文档的常见问题部分


