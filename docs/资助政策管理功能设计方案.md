# 资助政策管理功能设计方案

## 一、需求分析

### 1.1 现状问题

当前系统只有**补助套餐配置**（`st_subsidy_package`），缺少：
- 政策文档管理（政策文件、政策说明）
- 政策版本管理（不同学期可能有不同政策）
- 政策适用范围配置
- 政策与套餐的关联关系
- 政策发布和生效时间管理
- 政策查询和历史追溯

### 1.2 业务场景

1. **政策发布**：每年可能有新的资助政策，需要发布和管理
2. **政策版本**：不同学期可能使用不同版本的政策
3. **政策查询**：管理员需要查询当前有效的政策
4. **政策追溯**：需要查看历史政策，了解政策变更历史
5. **政策关联**：政策规定了哪些补助套餐，套餐金额等

---

## 二、功能设计

### 2.1 核心功能模块

#### 1. 政策文档管理
- 政策文件上传（Word/PDF）
- 政策内容编辑（富文本）
- 政策附件管理
- 政策文件下载

#### 2. 政策版本管理
- 政策版本创建（如：2024-2025学年政策）
- 版本号管理（v1.0, v2.0）
- 版本状态（草稿、已发布、已废止）
- 版本生效时间范围

#### 3. 政策适用范围
- 适用学制（小学/初中/高中）
- 适用年级（可选，如：高一、高二、高三）
- 适用学期（春季/秋季）
- 适用学年（如：2024-2025学年）

#### 4. 政策与套餐关联
- 政策关联的补助套餐列表
- 政策规定的补助标准（金额、条件等）
- 政策规定的申请条件

#### 5. 政策发布管理
- 政策发布（设置生效时间）
- 政策废止（设置废止时间）
- 政策状态管理（草稿、已发布、已废止）

#### 6. 政策查询
- 按学制查询有效政策
- 按学期查询有效政策
- 政策历史查询
- 政策详情查看

---

## 三、数据库设计

### 3.1 资助政策表 `st_subsidy_policy`

```sql
CREATE TABLE `st_subsidy_policy` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `policy_code` varchar(50) NOT NULL COMMENT '政策编号（唯一）',
  `policy_name` varchar(200) NOT NULL COMMENT '政策名称',
  `policy_version` varchar(20) NOT NULL COMMENT '政策版本（如：v1.0）',
  `policy_type` varchar(50) DEFAULT NULL COMMENT '政策类型（如：国家助学金、免学杂费）',
  `content` text COMMENT '政策内容（富文本）',
  `file_path` varchar(500) DEFAULT NULL COMMENT '政策文件路径（Word/PDF）',
  `file_name` varchar(200) DEFAULT NULL COMMENT '政策文件名称',
  `effective_date` date NOT NULL COMMENT '生效日期',
  `expiry_date` date DEFAULT NULL COMMENT '失效日期（NULL表示长期有效）',
  `status` int DEFAULT 0 COMMENT '状态：0=草稿,1=已发布,2=已废止',
  `publish_time` datetime DEFAULT NULL COMMENT '发布时间',
  `publisher` varchar(64) DEFAULT NULL COMMENT '发布人',
  `memo` text COMMENT '备注',
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `created_by` varchar(64) DEFAULT NULL COMMENT '创建人',
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `updated_by` varchar(64) DEFAULT NULL COMMENT '更新人',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_policy_code` (`policy_code`),
  INDEX `idx_status` (`status`),
  INDEX `idx_effective_date` (`effective_date`),
  INDEX `idx_policy_type` (`policy_type`)
) COMMENT='资助政策表';
```

### 3.2 政策适用范围表 `st_subsidy_policy_scope`

```sql
CREATE TABLE `st_subsidy_policy_scope` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `policy_id` bigint NOT NULL COMMENT '政策ID',
  `schooling_plan_id` bigint DEFAULT NULL COMMENT '适用学制ID（NULL表示所有学制）',
  `grade_name` varchar(50) DEFAULT NULL COMMENT '适用年级（如：高一、高二，NULL表示所有年级）',
  `semester` int DEFAULT NULL COMMENT '适用学期（1=春季,2=秋季，NULL表示所有学期）',
  `school_year` varchar(20) DEFAULT NULL COMMENT '适用学年（如：2024-2025，NULL表示所有学年）',
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  PRIMARY KEY (`id`),
  INDEX `idx_policy_id` (`policy_id`),
  INDEX `idx_schooling_plan_id` (`schooling_plan_id`)
) COMMENT='政策适用范围表';
```

### 3.3 政策与套餐关联表 `st_subsidy_policy_package`

```sql
CREATE TABLE `st_subsidy_policy_package` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `policy_id` bigint NOT NULL COMMENT '政策ID',
  `package_id` bigint NOT NULL COMMENT '补助套餐ID',
  `package_name` varchar(200) DEFAULT NULL COMMENT '套餐名称（冗余字段，方便查询）',
  `subsidy_amount` decimal(18, 2) DEFAULT NULL COMMENT '补助金额（冗余字段，记录政策规定的金额）',
  `sort_order` int DEFAULT 0 COMMENT '排序',
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_policy_package` (`policy_id`, `package_id`),
  INDEX `idx_policy_id` (`policy_id`),
  INDEX `idx_package_id` (`package_id`)
) COMMENT='政策与套餐关联表';
```

### 3.4 政策附件表 `st_subsidy_policy_attachment`（可选）

```sql
CREATE TABLE `st_subsidy_policy_attachment` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `policy_id` bigint NOT NULL COMMENT '政策ID',
  `file_name` varchar(200) NOT NULL COMMENT '文件名称',
  `file_path` varchar(500) NOT NULL COMMENT '文件路径',
  `file_size` bigint DEFAULT NULL COMMENT '文件大小（字节）',
  `file_type` varchar(50) DEFAULT NULL COMMENT '文件类型（如：pdf, docx）',
  `upload_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '上传时间',
  `upload_by` varchar(64) DEFAULT NULL COMMENT '上传人',
  PRIMARY KEY (`id`),
  INDEX `idx_policy_id` (`policy_id`)
) COMMENT='政策附件表';
```

---

## 四、核心功能实现

### 4.1 政策管理功能

#### 4.1.1 政策创建/编辑
- 基本信息：政策编号、名称、版本、类型
- 政策内容：富文本编辑器编辑政策内容
- 政策文件：上传政策文件（Word/PDF）
- 适用范围：选择适用的学制、年级、学期
- 关联套餐：选择该政策关联的补助套餐
- 生效时间：设置生效日期和失效日期

#### 4.1.2 政策发布
- 发布前校验：检查必填项、适用范围、关联套餐
- 状态变更：草稿 → 已发布
- 记录发布时间和发布人
- 如果已有同类型政策在有效期内，提示是否废止旧政策

#### 4.1.3 政策废止
- 设置废止时间
- 状态变更：已发布 → 已废止
- 记录废止原因

### 4.2 政策查询功能

#### 4.2.1 查询有效政策
```java
/**
 * 查询指定学制、学期的有效政策
 */
public List<SubsidyPolicy> getEffectivePolicies(Long schoolingPlanId, Long yearSemesterId) {
    // 1. 根据学年学期获取学年和学期信息
    // 2. 查询状态为"已发布"且当前日期在生效日期和失效日期之间的政策
    // 3. 过滤适用范围包含指定学制的政策
    // 4. 返回政策列表（包含关联的套餐信息）
}
```

#### 4.2.2 政策历史查询
- 查询所有政策（包括已废止的）
- 按政策类型、学制、时间范围筛选
- 查看政策变更历史

### 4.3 政策与套餐集成

#### 4.3.1 补助录入时显示政策
- 在补助录入页面显示当前有效的政策
- 显示政策规定的补助标准和条件
- 提供政策文件下载链接

#### 4.3.2 政策变更影响分析
- 当政策废止时，检查是否有使用该政策的补助记录
- 提示管理员政策变更的影响范围

---

## 五、前端界面设计

### 5.1 政策管理页面

#### 列表页
- 政策列表（表格）
  - 政策编号、名称、版本、类型
  - 生效日期、失效日期
  - 状态（草稿/已发布/已废止）
  - 适用范围（学制、年级）
  - 操作（查看、编辑、发布、废止、删除）

#### 编辑页
- 基本信息表单
- 政策内容编辑器（富文本）
- 政策文件上传
- 适用范围选择（多选：学制、年级、学期）
- 关联套餐选择（多选套餐）
- 生效时间设置

### 5.2 政策查询页面

#### 查询条件
- 政策类型
- 学制
- 学年学期
- 状态

#### 查询结果
- 政策列表
- 政策详情（包含内容、适用范围、关联套餐）
- 政策文件下载

### 5.3 补助录入页面集成

- 在补助录入页面顶部显示当前有效政策
- 点击查看政策详情
- 显示政策规定的补助标准

---

## 六、与现有系统集成

### 6.1 与补助套餐集成

**方案一：政策驱动套餐**（推荐）
- 政策创建时关联套餐
- 政策发布后，关联的套餐自动生效
- 政策废止后，关联的套餐可选择是否禁用

**方案二：套餐独立管理**
- 政策只作为参考文档
- 套餐仍然独立管理
- 政策中记录套餐信息，但不强制关联

**推荐方案一**，因为：
- 政策规定了补助标准，套餐应该遵循政策
- 政策变更时，可以统一管理套餐
- 更符合业务逻辑

### 6.2 与补助记录集成

- 补助记录中记录使用的政策ID（可选）
- 查询补助记录时，可以查看使用的政策
- 政策变更时，可以追溯历史记录使用的政策版本

---

## 七、实现步骤

### 阶段一：基础功能（1-2周）
1. 创建数据库表
2. 实现政策CRUD功能
3. 实现政策文件上传下载
4. 实现政策适用范围配置

### 阶段二：关联功能（1周）
1. 实现政策与套餐关联
2. 实现政策发布/废止功能
3. 实现政策查询功能

### 阶段三：集成功能（1周）
1. 在补助录入页面集成政策显示
2. 实现政策变更影响分析
3. 完善前端界面

### 阶段四：优化功能（可选，1周）
1. 政策版本对比功能
2. 政策变更通知
3. 政策统计分析

---

## 八、使用场景示例

### 场景1：发布新政策
```
1. 管理员创建新政策
   - 填写政策基本信息
   - 上传政策文件
   - 编辑政策内容
   - 选择适用范围（如：高中、2024-2025学年）
   - 关联补助套餐（如：助学金一档、二档、三档）

2. 发布政策
   - 设置生效日期（如：2024-09-01）
   - 系统检查是否有冲突政策
   - 发布成功，状态变为"已发布"

3. 政策生效
   - 补助录入时，系统自动显示该政策
   - 管理员可以查看政策规定的补助标准
```

### 场景2：政策废止
```
1. 管理员废止旧政策
   - 选择要废止的政策
   - 设置废止日期
   - 填写废止原因

2. 系统检查影响
   - 检查是否有使用该政策的补助记录
   - 提示管理员影响范围

3. 废止成功
   - 政策状态变为"已废止"
   - 政策不再在有效政策列表中显示
```

### 场景3：查询政策
```
1. 管理员查询政策
   - 选择学制（如：高中）
   - 选择学年学期（如：2024-2025学年秋季）
   - 查询有效政策

2. 查看政策详情
   - 查看政策内容
   - 查看适用范围
   - 查看关联的补助套餐
   - 下载政策文件
```

---

## 九、注意事项

1. **政策编号唯一性**：政策编号必须唯一，建议使用规则生成（如：ZC-2024-001）
2. **政策版本管理**：同一政策的不同版本应该使用不同的编号或版本号
3. **政策生效时间**：生效日期不能早于当前日期，失效日期不能早于生效日期
4. **政策废止影响**：废止政策时，需要检查是否有使用该政策的补助记录
5. **政策文件存储**：政策文件建议存储在文件服务器（如MinIO），数据库只存储路径
6. **权限控制**：政策发布/废止需要特定权限，普通用户只能查看

---

## 十、扩展功能（可选）

1. **政策模板**：提供政策模板，快速创建新政策
2. **政策审批流程**：政策发布前需要审批
3. **政策变更通知**：政策变更时通知相关管理员
4. **政策统计分析**：统计政策使用情况、政策变更频率等
5. **政策对比**：对比不同版本政策的差异


