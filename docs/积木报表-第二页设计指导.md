# 积木报表第二页设计指导：申请国家助学金的主要理由

## 一、设计思路

在积木报表中实现复选框效果，主要有以下几种方法：

### 方法一：使用条件表达式显示"√"或"□"（推荐）

使用条件判断，如果符合条件显示"√"，否则显示"□"。

### 方法二：使用图片组件

准备勾选和未勾选的图片，根据条件显示不同图片。

### 方法三：使用文本符号

直接使用Unicode符号：☑（已勾选）和 ☐（未勾选）。

---

## 二、SQL字段准备

已在SQL中添加了以下字段：
- `difficulty_type_id` - 困难类型ID
- `difficulty_type_text` - 困难类型文本
- `difficulty_level_id` - 困难等级ID
- `difficulty_level_text` - 困难等级文本
- `is_poverty_relief_family` - 是否脱贫户（1=是，0=否）
- `poverty_relief_year` - 脱贫年份
- `is_ethnic_class` - 是否民族高中班（1=是，0=否）

---

## 三、具体设计步骤

### 1. 设计"申请国家助学金的主要理由"部分

#### 步骤1：添加说明文字

在单元格中输入：
```
本人因属于如下原因(在打"√",可多选),家庭经济困难,特提出享受普通高中国家助学金申请,请予审核批准。
```

#### 步骤2：设计复选框行

对于每个选项，需要创建两列：
- **第一列**：复选框符号（√ 或 □）
- **第二列**：选项文字

**示例：脱贫家庭学生**

| 单元格 | 内容 | 表达式/说明 |
|--------|------|------------|
| A列 | 复选框 | `#{Zxjsq_Table.poverty_relief_check}` |
| B列 | 文字 | `脱贫家庭学生` |

**SQL中需要添加的字段：**

```sql
-- 脱贫家庭学生复选框
CASE 
    WHEN s.is_poverty_relief_family = '1' THEN '√' 
    ELSE '□' 
END AS poverty_relief_check,

-- 脱贫年份显示
CASE 
    WHEN s.is_poverty_relief_family = '1' AND s.poverty_relief_year IS NOT NULL 
    THEN CONCAT(s.poverty_relief_year, '年')
    ELSE ''
END AS poverty_relief_year_text,
```

#### 步骤3：处理嵌套选项

对于有子选项的（如"城乡低保家庭学生"），需要：

1. **主选项复选框**：判断困难类型是否包含该类型
2. **子选项复选框**：根据困难类型的详细值判断

**示例：城乡低保家庭学生**

```sql
-- 在SQL中添加
CASE 
    WHEN s.difficulty_type_id = '低保家庭' THEN '√' 
    ELSE '□' 
END AS low_income_check,
```

---

## 四、完整SQL字段补充

在SQL数据集中添加以下字段：

```sql
-- 申请理由复选框字段
CASE WHEN s.is_poverty_relief_family = '1' THEN '√' ELSE '□' END AS reason_1_poverty_relief,
CASE WHEN s.difficulty_type_id = '监测对象' THEN '√' ELSE '□' END AS reason_2_monitor,
CASE WHEN s.difficulty_type_id = '低保家庭' THEN '√' ELSE '□' END AS reason_3_low_income,
CASE WHEN s.difficulty_type_id = '特困救助' THEN '√' ELSE '□' END AS reason_4_special_hardship,
CASE WHEN s.difficulty_type_id = '残疾学生' THEN '√' ELSE '□' END AS reason_5_disabled,
CASE WHEN s.difficulty_type_id = '孤儿' THEN '√' ELSE '□' END AS reason_6_orphan,
CASE WHEN s.difficulty_type_id = '烈士子女' THEN '√' ELSE '□' END AS reason_7_martyr,
CASE WHEN s.difficulty_type_id = '困难职工' THEN '√' ELSE '□' END AS reason_8_worker,
CASE WHEN s.difficulty_type_id = '低保边缘' THEN '√' ELSE '□' END AS reason_9_margin,
CASE WHEN s.difficulty_type_id = '支出型困难' THEN '√' ELSE '□' END AS reason_10_expenditure,
CASE WHEN s.is_ethnic_class = '1' THEN '√' ELSE '□' END AS reason_11_ethnic_class,
CASE WHEN s.difficulty_type_id NOT IN ('脱贫','监测对象','低保','特困','残疾','孤儿','烈士','职工','边缘','支出型') 
     AND s.difficulty_type_id IS NOT NULL 
     THEN '√' 
     ELSE '□' 
END AS reason_12_other,

-- 脱贫年份显示
CASE 
    WHEN s.is_poverty_relief_family = '1' AND s.poverty_relief_year IS NOT NULL 
    THEN CONCAT(s.poverty_relief_year, '年')
    ELSE ''
END AS poverty_relief_year_text,

-- 其他原因说明
CASE 
    WHEN s.difficulty_type_id NOT IN ('脱贫','监测对象','低保','特困','残疾','孤儿','烈士','职工','边缘','支出型') 
     AND s.difficulty_type_id IS NOT NULL 
    THEN s.memo
    ELSE ''
END AS other_reason_text,
```

---

## 五、报表设计器中的布局

### 布局示例：

```
行1: 说明文字（合并单元格）
行2: □ 脱贫家庭学生  脱贫年度: [年份显示]
行3:   □2014年 □2015年 ... □2020年
行4: □ 符合资助条件的监测对象家庭学生
行5:   (□脱贫不稳定家庭学生 □边缘易致贫家庭学生 □突发严重困难家庭学生)
行6: □ 城乡低保家庭学生
行7:   (□城市低保家庭学生 □农村低保家庭学生)
...（其他选项类似）
```

### 单元格绑定示例：

| 位置 | 内容 | 表达式 |
|------|------|--------|
| A2 | 复选框 | `#{Zxjsq_Table.reason_1_poverty_relief}` |
| B2 | 文字 | `脱贫家庭学生` |
| C2 | 文字 | `脱贫年度:` |
| D2 | 年份 | `#{Zxjsq_Table.poverty_relief_year_text}` |

---

## 六、高级技巧

### 1. 使用条件格式

在积木报表中，可以设置单元格的条件格式：
- 如果值为"√"，设置字体颜色为黑色、加粗
- 如果值为"□"，设置字体颜色为灰色

### 2. 使用公式判断

如果积木报表支持公式，可以使用：
```
IF(#{Zxjsq_Table.is_poverty_relief_family}='1', '√', '□')
```

### 3. 动态显示子选项

对于有子选项的，可以使用条件显示：
- 如果主选项为"√"，显示子选项行
- 否则隐藏子选项行

---

## 七、注意事项

1. **字典值匹配**：需要根据实际的困难类型字典值来调整SQL中的判断条件
2. **复选框符号**：可以使用"√"、"☑"、"✓"等符号，根据打印效果选择
3. **年份显示**：脱贫年份需要格式化显示，如"2014年"
4. **其他原因**：如果选择"其他"，需要显示具体说明（可以使用memo字段）

---

## 八、快速实现方案

如果上述方法太复杂，可以采用简化方案：

1. **只显示已选中的选项**：使用条件判断，只显示勾选的选项
2. **使用文本列表**：将所有符合条件的选项用逗号分隔显示在一行
3. **使用表格**：将选项做成表格，每行一个选项，根据条件显示"√"

---

## 九、测试建议

1. 先测试单个复选框是否能正确显示
2. 测试多个复选框同时勾选的情况
3. 测试嵌套选项的显示
4. 测试年份等动态内容的显示
5. 测试打印效果，确保符号清晰

