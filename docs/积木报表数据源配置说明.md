# 积木报表数据源配置说明

## 问题描述

在新建报表时，出现 `NullPointerException` 错误：
```
java.lang.NullPointerException: null
at org.jeecg.modules.jmreport.desreport.service.a.i.initDataSource(JmReportDbServiceImpl.java:400)
at org.jeecg.modules.jmreport.desreport.service.a.i.getDataSourceByPages(JmReportDbServiceImpl.java:910)
```

## 问题原因

积木报表在初始化数据源时，需要从数据库表 `jimu_report_data_source` 中读取数据源配置。如果该表为空或没有默认数据源配置，就会出现 `NullPointerException`。

## 解决方案

### 方案1：在数据库中插入默认数据源配置（推荐）

执行 `docs/sql/jimureport_init_datasource.sql` 脚本，在 `jimu_report_data_source` 表中插入一个默认的数据源配置。

**重要**：执行前请修改脚本中的数据库连接信息：
- `db_url`：数据库连接URL
- `db_username`：数据库用户名
- `db_password`：数据库密码

这些信息应该与 `application-druid.yml` 中的 `spring.datasource.druid.master` 配置一致。

### 方案2：在积木报表设计器中手动配置数据源

1. 访问积木报表设计器：`http://localhost:8080/jmreport/designer`
2. 在数据源管理中添加数据源
3. 配置数据库连接信息

### 方案3：检查数据库表是否存在

确保已执行完整的 `jimureport.sql` 脚本，包括 `jimu_report_data_source` 表。

## 执行步骤

1. **修改脚本**：打开 `docs/sql/jimureport_init_datasource.sql`
2. **修改数据库连接信息**：
   - 根据 `application-druid.yml` 中的配置修改 `db_url`、`db_username`、`db_password`
3. **执行脚本**：在数据库中执行修改后的SQL脚本
4. **重启应用**：重启后端服务
5. **测试**：再次尝试新建报表

## 验证

执行脚本后，可以查询数据源配置：
```sql
SELECT id, name, db_type, db_url FROM jimu_report_data_source;
```

如果查询到数据，说明配置成功。

## 注意事项

1. **数据库连接信息**：必须与系统主数据源的配置一致
2. **表结构**：确保 `jimu_report_data_source` 表已创建
3. **权限**：确保数据库用户有足够的权限访问目标数据库

